 CREATE DATABASE BOOK_MANAGEMENT;
 
 USE BOOK_MANAGEMENT;
 
 CREATE TABLE CATEGORIES (
    CATEGORY_ID INT PRIMARY KEY,
    NAME VARCHAR(255)
 );
 
 CREATE TABLE BOOKS (
    BOOK_ID INT PRIMARY KEY,
    TITLE VARCHAR(255) ,
    AUTHOR VARCHAR(255),
    PUBLICATION_YEAR INT,
    AVAILABLE_QUANTITY INT,
    CATEGORY_ID INT NOT NULL
 );
 
 CREATE TABLE READERS(
   READER_ID INT PRIMARY KEY,
   NAME VARCHAR(255),
   PHONE_NUMBER VARCHAR(15),
   EMAIL VARCHAR(255) 
 );
 
 CREATE TABLE BORROWING (
   BORROW_ID INT PRIMARY KEY,
   READER_ID INT,
   BOOK_ID INT,
   BORROW_DATE DATE ,
   DUE_DATE  DATE
 );
 
 CREATE TABLE RETURNING (
    RETURN_ID INT PRIMARY KEY,
    BORROW_ID INT,
    RETURN_DATE DATE
 );
 
 CREATE TABLE FINES (
    FINR_ID INT,
    RETURN_ID INT,
    FINE_AMOUNT DECIMAL(10,2)
 );
 
 ALTER TABLE BOOKS
 ADD CONSTRAINT FK_CATEGORIES_BOOKS
 FOREIGN KEY(CATEGORY_ID) REFERENCES CATEGORIES(CATEGORY_ID) ON DELETE CASCADE;
 
 ALTER TABLE BORROWING
 ADD CONSTRAINT FK_READERS_BORROWNG
 FOREIGN KEY(READER_ID) REFERENCES READERS(READER_ID) ON DELETE CASCADE;
 
 ALTER TABLE BORROWING
 ADD CONSTRAINT FK_BOOKS_BORROWNG
 FOREIGN KEY(BOOK_ID) REFERENCES BOOKS(BOOK_ID) ON DELETE CASCADE;
 
 ALTER TABLE RETURNING
 ADD CONSTRAINT FK_BORROWNG_RETURNING
 FOREIGN KEY(BORROW_ID) REFERENCES BORROWING(BORROW_ID);
 
 ALTER TABLE FINES
 ADD CONSTRAINT FK_RETURNING_FINES
 FOREIGN KEY(RETURN_ID) REFERENCES RETURNING(RETURN_ID);
 
 
 
 -- Thêm dữ liệu vào bảng CATEGORIES
INSERT INTO CATEGORIES VALUES 
(1, 'Khoa học'),
(2, 'Văn học');

-- Thêm dữ liệu vào bảng BOOKS
INSERT INTO BOOKS VALUES 
(1, 'Vũ trụ trong vỏ hạt dẻ', 'Stephen Hawking', 2001, 5, 1),
(2, 'Nhà giả kim', 'Paulo Coelho', 1988, 10, 2);

-- Thêm dữ liệu vào bảng READERS
INSERT INTO READERS VALUES 
(1, 'Nguyễn Văn A', '0987654321', 'nguyenvana@example.com'),
(2, 'Trần Thị B', '0912345678', 'tranthib@example.com');

-- Thêm dữ liệu vào bảng BORROWING
INSERT INTO BORROWING VALUES 
(1, 1, 1, '2025-02-01', '2025-02-10'),
(2, 2, 2, '2025-02-05', '2025-02-15');

-- Thêm dữ liệu vào bảng RETURNING
INSERT INTO RETURNING VALUES 
(1, 1, '2025-02-09'),
(2, 2, '2025-02-18');

-- Thêm dữ liệu vào bảng FINES
INSERT INTO FINES VALUES 
(1, 1, 0.00),  -- Không trễ hạn
(2, 2, 50000.00);  -- Trễ hạn, phạt 50,000 VNĐ

-- Kiểm tra lại dữ liệu
SELECT * FROM CATEGORIES;
SELECT * FROM BOOKS;
SELECT * FROM READERS;
SELECT * FROM BORROWING;
SELECT * FROM RETURNING;
SELECT * FROM FINES;

-- cập nhật thông tin của một sinh viên bất kì
UPDATE  READERS
SET NAME = 'Lương Hoàng Bảo Trân'
WHERE NAME = 'Trần Thị B'

DELETE FROM BOOKS
WHERE BOOK_ID = 1


-- debug
SELECT * FROM BORROWING WHERE BOOK_ID = 1;

ALTER TABLE RETURNING DROP FOREIGN KEY FK_BORROWNG_RETURNING;
ALTER TABLE RETURNING ADD CONSTRAINT FK_BORROWNG_RETURNING
FOREIGN KEY(BORROW_ID) REFERENCES BORROWING(BORROW_ID) ON DELETE CASCADE;

ALTER TABLE FINES DROP FOREIGN KEY FK_RETURNING_FINES;
ALTER TABLE FINES ADD CONSTRAINT FK_RETURNING_FINES
FOREIGN KEY(RETURN_ID) REFERENCES RETURNING(RETURN_ID) ON DELETE CASCADE;


